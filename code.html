<html lang="ja">
<meta name="referrer" content="unsafe-url">

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://sdk-stg.form.run/js/v2/formrun.js"></script>
  <style>
    body {
      margin: 50px;
    }
  </style>
  <title>code</title>
</head>

<body>
  <div class="row">
    <div class="col-sm-8">
      <div class="card mb-3">
        <div class="card-body">
          <h2>
            埋め込みに必要な情報
          </h2>
          <div class="form-group">
            <label>FormタグのactionのURL</label>
            <input name="action" type="text" class="form-control" id="action_url"
              placeholder="https://form.run/api/v1/r/fuomni12q5wpzyzprru3mas9">
            <div class="small">現在の値：<span id="action_url_current"></span></div>
          </div>


          <div class="form-group mt-3">
            <label>スクリプト設置タグ</label>
            <input name="script" type="text" class="form-control" id="script_tag"
              placeholder="&lt;script src=&quot;https://sdk.form.run/js/v2/formrun.js&quot;&gt;&lt;/script&gt;">
            <div class="small">現在の値：<span id="script_tag_current"></span></div>
          </div>


          <button class="btn btn-primary mt-3" id="embed_form_info">埋め込み</button>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-6">
      <h1>
        コード型で埋め込み
      </h1>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-6">
      <form class="formrun" method="post" data-formrun-saving="true" data-formrun-confirm="true">

        <div class="card mb-3">
          <div class="card-body">

            <h3>
              コード設置画面サンプルコード
            </h3>
            <!-- ↓自由に要素を追加・編集することができます -->
            <div class="form-group">
              <label>お名前t</label><span class="badge bg-secondary text-white">任意</span>
              <input name="お名前1" type="text" class="form-control">
            </div>

            <div class="form-group">
              <label>メールアドレス</label><span class="badge bg-danger text-white">必須</span>
              <input name="メールアドレス1" type="text" data-formrun-type="email" class="form-control" data-formrun-required>
              <div data-formrun-show-if-error="メールアドレス1" class="text-danger">メールアドレスを正しく入力してください</div>
            </div>

            <div class="form-group">
              <label>電話番号</label><span class="badge bg-secondary text-white">任意</span>
              <input name="電話番号1" data-formrun-type="tel" class="form-control" data-formrun-chars-max="10">
              <div data-formrun-show-if-error="電話番号1" class="text-danger">電話番号を正しく入力してください</div>
            </div>

            <div class="form-group">
              <label>住所</label><span class="badge bg-secondary text-white">任意</span>
              <input name="住所1" type="text" class="form-control">
            </div>

            <div class="form-group row">
              <label class="col-sm-2">お問い合わせ種類</label>
              <div class="col-sm-10">
                <select class="form-control form-control-lg" name="お問い合わせ種類" data-formrun-required>
                  <option value>--選択してください--</option>
                  <option value="inquiry-type-1">お問い合わせ種類1</option>
                  <option value="inquiry-type-2">お問い合わせ種類2</option>
                  <option value="inquiry-type-3">お問い合わせ種類3</option>
                  <option value="inquiry-type-4">お問い合わせ種類4</option>
                  <option value="inquiry-type-5">お問い合わせ種類5</option>
                  <option value="inquiry-type-other">その他</option>
                </select>
                <span class="text-danger" data-formrun-show-if-error="業種">お問い合わせ種類を正しく入力してください</span>
              </div>
            </div>

            <div class="form-group">
              <label>お問い合わせ</label><span class="badge bg-danger text-white">必須</span>
              <textarea name="お問い合わせ" class="form-control" data-formrun-required></textarea>
              <div data-formrun-show-if-error="お問い合わせ" class="text-danger">お問い合わせ入力してください</div>
            </div>

            <div class="form-group form-group">
              <div><label>個人情報利用同意</label><span class="badge bg-secondary text-white">任意</span>
              <input type="checkbox" name="個人情報利用同意" class="form-check-label" data-formrun-required>
              <div data-formrun-show-if-error="個人情報利用同意" class="text-danger">同意してください</div>
            </div>

            <!-- ボット投稿をブロックするためのタグ -->
            <div class="_formrun_gotcha form-group form-check">
              <style media="screen">
                ._formrun_gotcha {
                  position: absolute !important;
                  height: 1px;
                  width: 1px;
                  overflow: hidden;
                }
              </style>
              <label for="_formrun_gotcha" class="form-check-label">If you are a human, ignore this field</label>
              <input type="text" name="_formrun_gotcha" id="_formrun_gotcha" tabindex="-1" class="form-check-input">
            </div>
          </div>
        </div>

        <div data-formrun-hide-if-confirm>データを入力して確認ボタンを押してください。</div>

        <div data-formrun-show-if-confirm>データを確認の上送信してください</div>

        <a href="javascript:void(0)" class="btn btn-secondary" data-formrun-back-button>戻る</a>
        <button type="submit" class="btn btn-primary" data-formrun-invalid-input-error-text="正しく入力されていない項目があります"
          data-formrun-error-text="未入力の項目があります" data-formrun-submitting-text="送信中...">確認</button>
      </form>
    </div>
  </div>
</body>

<script id="formrun_js_script"></script>

<script>
  const KEY_ACTION_URL = 'last_display_action_url';
  const KEY_SCRIPT_TAG = 'last_display_script_tag';


  const loadLocalStorage = () => {
    const actionUrl = window.localStorage.getItem(KEY_ACTION_URL);
    const script = window.localStorage.getItem(KEY_SCRIPT_TAG);
    if (!actionUrl || !script) { return; }

    document.querySelector('form.formrun').action = actionUrl
    document.querySelector('#action_url').value = actionUrl
    document.querySelector('#action_url_current').textContent = actionUrl

    document.querySelector('#formrun_js_script').src = extractSourceUrl(script)
    document.querySelector('#script_tag').value = script
    document.querySelector('#script_tag_current').textContent = script

  }

  const extractSourceUrl = (tag) => {
    const sourceUrl = tag.match(/script src="(https:\/\/.+.formrun.js)"/);
    return !!sourceUrl ? sourceUrl[1] : null;
  }

  const embedFormInfo = () => {
    const actionUrl = document.querySelector('#action_url').value;
    const scriptTag = document.querySelector('#script_tag').value;
    const sourceUrl = extractSourceUrl(scriptTag);

    if (!sourceUrl) {
      window.alert('不正なスクリプトです');
      return;
    }
    window.localStorage.setItem(KEY_ACTION_URL, actionUrl);
    window.localStorage.setItem(KEY_SCRIPT_TAG, scriptTag);

    document.querySelector('form.formrun').action = actionUrl
    document.querySelector('#action_url_current').textContent = actionUrl
    document.querySelector('#formrun_js_script').src = sourceUrl
    document.querySelector('#script_tag_current').textContent = scriptTag
  };

  const onloadEvent = () => {
    loadLocalStorage();
    document.querySelector('#embed_form_info').addEventListener('click', embedFormInfo);
  };
  window.addEventListener('load', onloadEvent);

</script>
